<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>RxPatterns</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <link href="css/styles.css" rel="stylesheet">
</head>
<body>
<div class="container">
    <div class="row">
        <div id="sidebar-menu" class="col-2">
            <ul class="main-menu nav nav-stacked affix">
            </ul>
        </div>
        <div id="static-content" class="col-10">
            <h1 id="par-1">Combining</h1>
            <h2 id="sub-par-1-1">Creating pairs</h2>
            <p>
                This demo generates consecutive pairs from a sequence of numbers. This is done by combining the original sequence with the same sequence starting from the second element (the skip(1)). The zip function combines the elements from both streams in order and emits as many items as the source observable with the fewest items.
                See <a href="http://reactivex.io/documentation/operators/zip.html" class="href">Zip function</a>.
            </p>
            <p>
                <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #888888">// Input:  1 - 2 - 3 - 4 - 5 - 6 - 7 - 8</span>
        <span style="color: #888888">// Output: [1, 2] - [2, 3]-  [3, 4]-  [4, 5] -  [5, 6] - [6, 7], [7, 8]</span>
        <span style="color: #008800; font-weight: bold">final</span> Observable<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">&gt;</span> numbers <span style="color: #333333">=</span> Observable<span style="color: #333333">.</span><span style="color: #0000CC">from</span><span style="color: #333333">(</span>Arrays<span style="color: #333333">.</span><span style="color: #0000CC">asList</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">2</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">3</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">4</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">5</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">6</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">7</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">8</span><span style="color: #333333">));</span>

        numbers
                <span style="color: #333333">.</span><span style="color: #0000CC">zipWith</span><span style="color: #333333">(</span>numbers
                        <span style="color: #333333">.</span><span style="color: #0000CC">skip</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">),</span> <span style="color: #333333">(</span>first<span style="color: #333333">,</span> second<span style="color: #333333">)</span> <span style="color: #333333">-&gt;</span> Arrays<span style="color: #333333">.</span><span style="color: #0000CC">asList</span><span style="color: #333333">(</span>first<span style="color: #333333">,</span> second<span style="color: #333333">))</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">subscribe</span><span style="color: #333333">(</span>System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">::</span>println<span style="color: #333333">);</span>
</pre></div>

            </p>
            <h1 id="par-2">Network requests</h1>
            <h2 id="sub-par-2-1">Retrofit Android</h2>
            <p>
                This patterns demos executing a <a href="http://square.github.io/retrofit/">Retrofit</a> request within Android. To always execute the request in the background you can create the RxJavaCallAdapter by using the Schedulers.io() scheduler. For testing you can pass an immediate() or a test scheduler during creation of the API.
            </p>
            <p>
                Make sure that when you touch any views in the subsribe function, you must use observeOn(AndroidSchedulers.mainThread()) because views can only be updated from the main thread. Also use an onError handler to avoid OnErrorNotImplemented exceptions.
            </p>
            <p>
                The subscription is unsubscribed when the network request is finished. It is good practive however to unsubsribe in the proper life-cycle method, for example onPause(). For this you can use a CompositeSubscription and add any subscriptions that must be unsubscribed when the activity pauses. To unsubscribe using a CompositeSubscription call its clear() method. By using the clear() method, the CompositeSubscription can be re-used in contrast to the unsubscribe() method.
            </p>
            <p>
                <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">RetrofitTest</span> <span style="color: #333333">{</span>
    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">main</span><span style="color: #333333">(</span>String<span style="color: #333333">[]</span> args<span style="color: #333333">)</span> <span style="color: #008800; font-weight: bold">throws</span> IOException <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">final</span> MockWebServer mockWebServer <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> MockWebServer<span style="color: #333333">();</span>
        mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">enqueue</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> MockResponse<span style="color: #333333">().</span><span style="color: #0000CC">setBody</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;{\&quot;message\&quot;: \&quot;Hallo\&quot;}&quot;</span><span style="color: #333333">).</span><span style="color: #0000CC">setResponseCode</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">200</span><span style="color: #333333">));</span>
        mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">play</span><span style="color: #333333">();</span>
        <span style="color: #008800; font-weight: bold">final</span> TestApi api <span style="color: #333333">=</span> getApi<span style="color: #333333">(</span>mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">getUrl</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;/&quot;</span><span style="color: #333333">).</span><span style="color: #0000CC">toString</span><span style="color: #333333">(),</span> Schedulers<span style="color: #333333">.</span><span style="color: #0000CC">io</span><span style="color: #333333">());</span>
        <span style="color: #008800; font-weight: bold">final</span> Subscription subscription <span style="color: #333333">=</span> api<span style="color: #333333">.</span><span style="color: #0000CC">getMessage</span><span style="color: #333333">()</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">observeOn</span><span style="color: #333333">(</span>AndroidSchedulers<span style="color: #333333">.</span><span style="color: #0000CC">mainThread</span><span style="color: #333333">())</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">subscribe</span><span style="color: #333333">(</span>System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">::</span>println<span style="color: #333333">,</span>
                        <span style="color: #997700; font-weight: bold">Throwable:</span><span style="color: #333333">:</span>printStackTrace<span style="color: #333333">);</span>

<span style="color: #888888">//        when result is delivered, subscription is unsubscribed. In Android, best to unsubscribe in lifecycle methods since</span>
        <span style="color: #888888">// the request does not always complete (for example on orientation change, back button etc.)</span>
        System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">.</span><span style="color: #0000CC">println</span><span style="color: #333333">(</span>subscription<span style="color: #333333">.</span><span style="color: #0000CC">isUnsubscribed</span><span style="color: #333333">());</span>

        mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">shutdown</span><span style="color: #333333">();</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">static</span> TestApi <span style="color: #0066BB; font-weight: bold">getApi</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">final</span> String baseUrl<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">final</span> Scheduler scheduler<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">new</span> Retrofit<span style="color: #333333">.</span><span style="color: #0000CC">Builder</span><span style="color: #333333">()</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">baseUrl</span><span style="color: #333333">(</span>baseUrl<span style="color: #333333">)</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">addCallAdapterFactory</span><span style="color: #333333">(</span>RxJavaCallAdapterFactory<span style="color: #333333">.</span><span style="color: #0000CC">createWithScheduler</span><span style="color: #333333">(</span>scheduler<span style="color: #333333">))</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">addConverterFactory</span><span style="color: #333333">(</span>GsonConverterFactory<span style="color: #333333">.</span><span style="color: #0000CC">create</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> GsonBuilder<span style="color: #333333">().</span><span style="color: #0000CC">create</span><span style="color: #333333">()))</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">build</span><span style="color: #333333">().</span><span style="color: #0000CC">create</span><span style="color: #333333">(</span>TestApi<span style="color: #333333">.</span><span style="color: #0000CC">class</span><span style="color: #333333">);</span>
    <span style="color: #333333">}</span>
<span style="color: #333333">}</span>
</pre></div>

            </p>
            <h2 id="sub-par-2-2">Combine network requests/responses</h2>
            <p>
                <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">CombineNetworkRequests</span> <span style="color: #333333">{</span>
    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">main</span><span style="color: #333333">(</span>String<span style="color: #333333">[]</span> args<span style="color: #333333">)</span> <span style="color: #008800; font-weight: bold">throws</span> IOException <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">final</span> MockWebServer mockWebServer <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> MockWebServer<span style="color: #333333">();</span>
        mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">enqueue</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> MockResponse<span style="color: #333333">().</span><span style="color: #0000CC">setBody</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;{\&quot;lat\&quot;: 52.2, \&quot;lng\&quot;: 5.1}&quot;</span><span style="color: #333333">).</span><span style="color: #0000CC">setResponseCode</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">200</span><span style="color: #333333">));</span> <span style="color: #888888">// Response for getLastKnownLocation</span>
        mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">enqueue</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> MockResponse<span style="color: #333333">().</span><span style="color: #0000CC">setBody</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;{\&quot;lat\&quot;: 52.55, \&quot;lng\&quot;: 5.11}&quot;</span><span style="color: #333333">).</span><span style="color: #0000CC">setResponseCode</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">200</span><span style="color: #333333">));</span> <span style="color: #888888">// Response for resolve location</span>
        mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">enqueue</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> MockResponse<span style="color: #333333">().</span><span style="color: #0000CC">setBody</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;{\&quot;temp\&quot;: 18.5}&quot;</span><span style="color: #333333">).</span><span style="color: #0000CC">setResponseCode</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">200</span><span style="color: #333333">));</span> <span style="color: #888888">// Response for weather</span>
        mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">enqueue</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> MockResponse<span style="color: #333333">().</span><span style="color: #0000CC">setBody</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;{\&quot;name\&quot;: \&quot;Utrecht\&quot;}&quot;</span><span style="color: #333333">).</span><span style="color: #0000CC">setResponseCode</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">200</span><span style="color: #333333">));</span> <span style="color: #888888">// Response for location</span>
        mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">start</span><span style="color: #333333">();</span>

        <span style="color: #008800; font-weight: bold">final</span> String baseUrl <span style="color: #333333">=</span> mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">url</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;/&quot;</span><span style="color: #333333">).</span><span style="color: #0000CC">toString</span><span style="color: #333333">();</span>
        <span style="color: #008800; font-weight: bold">final</span> LocationApi locationApi <span style="color: #333333">=</span> RetroFitFactory<span style="color: #333333">.</span><span style="color: #0000CC">getApi</span><span style="color: #333333">(</span>baseUrl<span style="color: #333333">,</span> Schedulers<span style="color: #333333">.</span><span style="color: #0000CC">immediate</span><span style="color: #333333">()).</span><span style="color: #0000CC">create</span><span style="color: #333333">(</span>LocationApi<span style="color: #333333">.</span><span style="color: #0000CC">class</span><span style="color: #333333">);</span>
        <span style="color: #008800; font-weight: bold">final</span> WeatherApi weatherApi <span style="color: #333333">=</span> RetroFitFactory<span style="color: #333333">.</span><span style="color: #0000CC">getApi</span><span style="color: #333333">(</span>baseUrl<span style="color: #333333">,</span> Schedulers<span style="color: #333333">.</span><span style="color: #0000CC">immediate</span><span style="color: #333333">()).</span><span style="color: #0000CC">create</span><span style="color: #333333">(</span>WeatherApi<span style="color: #333333">.</span><span style="color: #0000CC">class</span><span style="color: #333333">);</span>
        <span style="color: #008800; font-weight: bold">final</span> PlacesApi placesApi <span style="color: #333333">=</span> RetroFitFactory<span style="color: #333333">.</span><span style="color: #0000CC">getApi</span><span style="color: #333333">(</span>baseUrl<span style="color: #333333">,</span> Schedulers<span style="color: #333333">.</span><span style="color: #0000CC">immediate</span><span style="color: #333333">()).</span><span style="color: #0000CC">create</span><span style="color: #333333">(</span>PlacesApi<span style="color: #333333">.</span><span style="color: #0000CC">class</span><span style="color: #333333">);</span>

        getLastKnownLocationObservable<span style="color: #333333">(</span>locationApi<span style="color: #333333">).</span><span style="color: #0000CC">switchIfEmpty</span><span style="color: #333333">(</span>locationApi<span style="color: #333333">.</span><span style="color: #0000CC">resolveUserLocation</span><span style="color: #333333">())</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">flatMap</span><span style="color: #333333">(</span>location <span style="color: #333333">-&gt;</span> weatherApi<span style="color: #333333">.</span><span style="color: #0000CC">getTemp</span><span style="color: #333333">(</span>location<span style="color: #333333">.</span><span style="color: #0000CC">lat</span><span style="color: #333333">,</span> location<span style="color: #333333">.</span><span style="color: #0000CC">lng</span><span style="color: #333333">)</span>
                        <span style="color: #333333">.</span><span style="color: #0000CC">zipWith</span><span style="color: #333333">(</span>placesApi<span style="color: #333333">.</span><span style="color: #0000CC">reverseGeocode</span><span style="color: #333333">(</span>location<span style="color: #333333">.</span><span style="color: #0000CC">lat</span><span style="color: #333333">,</span> location<span style="color: #333333">.</span><span style="color: #0000CC">lng</span><span style="color: #333333">),</span> <span style="color: #333333">(</span>Func2<span style="color: #333333">&lt;</span>Weather<span style="color: #333333">,</span> City<span style="color: #333333">,</span> Pair<span style="color: #333333">&gt;)</span> <span style="color: #997700; font-weight: bold">Pair:</span><span style="color: #333333">:</span><span style="color: #008800; font-weight: bold">new</span><span style="color: #333333">))</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">subscribe</span><span style="color: #333333">(</span>System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">::</span>println<span style="color: #333333">);</span>

        mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">shutdown</span><span style="color: #333333">();</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">static</span> Observable<span style="color: #333333">&lt;</span>Location<span style="color: #333333">&gt;</span> <span style="color: #0066BB; font-weight: bold">getLastKnownLocationObservable</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">final</span> LocationApi locationApi<span style="color: #333333">)</span> <span style="color: #333333">{</span>
<span style="color: #888888">//        return Observable.empty();</span>
        <span style="color: #008800; font-weight: bold">return</span> locationApi<span style="color: #333333">.</span><span style="color: #0000CC">getLastKnownLocation</span><span style="color: #333333">();</span>
    <span style="color: #333333">}</span>
<span style="color: #333333">}</span>
</pre></div>

            </p>
            <h2 id="sub-par-2-3">Cache network responses</h2>
            <p>
                <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">CacheNetworkResponses</span> <span style="color: #333333">{</span>
    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333399; font-weight: bold">boolean</span> simulateNetworkError<span style="color: #333333">;</span>

    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">main</span><span style="color: #333333">(</span>String<span style="color: #333333">[]</span> args<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">final</span> Cache memoryCache <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Cache<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;MEMORY&quot;</span><span style="color: #333333">),</span> diskCache <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Cache<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;DISK&quot;</span><span style="color: #333333">);</span>

        <span style="color: #008800; font-weight: bold">final</span> Observable<span style="color: #333333">&lt;</span>String<span style="color: #333333">&gt;</span> multipleSources <span style="color: #333333">=</span> Observable<span style="color: #333333">.</span><span style="color: #0000CC">concat</span><span style="color: #333333">(</span>
                memoryCache<span style="color: #333333">.</span><span style="color: #0000CC">getFromCache</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">),</span>
                diskCache<span style="color: #333333">.</span><span style="color: #0000CC">getFromCache</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">),</span>
                fromNetwork<span style="color: #333333">()</span>
                        <span style="color: #333333">.</span><span style="color: #0000CC">doOnNext</span><span style="color: #333333">(</span><span style="color: #997700; font-weight: bold">memoryCache:</span><span style="color: #333333">:</span>putInCache<span style="color: #333333">)</span>
                        <span style="color: #333333">.</span><span style="color: #0000CC">doOnNext</span><span style="color: #333333">(</span><span style="color: #997700; font-weight: bold">diskCache:</span><span style="color: #333333">:</span>putInCache<span style="color: #333333">)</span>
                        <span style="color: #333333">.</span><span style="color: #0000CC">onErrorResumeNext</span><span style="color: #333333">(</span>throwable <span style="color: #333333">-&gt;</span>
                                diskCache<span style="color: #333333">.</span><span style="color: #0000CC">getFromCache</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">)</span>
                                        <span style="color: #333333">.</span><span style="color: #0000CC">filter</span><span style="color: #333333">(</span><span style="color: #997700; font-weight: bold">Objects:</span><span style="color: #333333">:</span>nonNull<span style="color: #333333">)</span>
                                        <span style="color: #333333">.</span><span style="color: #0000CC">switchIfEmpty</span><span style="color: #333333">(</span>Observable<span style="color: #333333">.</span><span style="color: #0000CC">error</span><span style="color: #333333">(</span>throwable<span style="color: #333333">)))</span>
        <span style="color: #333333">)</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">take</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">);</span>

        multipleSources
                <span style="color: #333333">.</span><span style="color: #0000CC">subscribe</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> DataSubscriber<span style="color: #333333">());</span>

        multipleSources
                <span style="color: #333333">.</span><span style="color: #0000CC">subscribe</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> DataSubscriber<span style="color: #333333">());</span>

        memoryCache<span style="color: #333333">.</span><span style="color: #0000CC">invalidate</span><span style="color: #333333">();</span>

        multipleSources
                <span style="color: #333333">.</span><span style="color: #0000CC">subscribe</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> DataSubscriber<span style="color: #333333">());</span>

        simulateNetworkError <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">;</span>
        diskCache<span style="color: #333333">.</span><span style="color: #0000CC">stale</span> <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">;</span>

        multipleSources
                <span style="color: #333333">.</span><span style="color: #0000CC">subscribe</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> DataSubscriber<span style="color: #333333">());</span>

        simulateNetworkError <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">;</span>
        diskCache<span style="color: #333333">.</span><span style="color: #0000CC">cached</span> <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">;</span>

        multipleSources
                <span style="color: #333333">.</span><span style="color: #0000CC">subscribe</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> DataSubscriber<span style="color: #333333">());</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">static</span> Observable<span style="color: #333333">&lt;</span>String<span style="color: #333333">&gt;</span> <span style="color: #0066BB; font-weight: bold">fromNetwork</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">return</span> Observable<span style="color: #333333">.</span><span style="color: #0000CC">fromCallable</span><span style="color: #333333">(()</span> <span style="color: #333333">-&gt;</span> <span style="color: #333333">{</span>
            System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">.</span><span style="color: #0000CC">println</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;getFrom NETWORK&quot;</span><span style="color: #333333">);</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>simulateNetworkError<span style="color: #333333">)</span> <span style="color: #333333">{</span>
                <span style="color: #008800; font-weight: bold">throw</span> <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066BB; font-weight: bold">RuntimeException</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Network error occurred&quot;</span><span style="color: #333333">);</span>
            <span style="color: #333333">}</span>
            <span style="color: #008800; font-weight: bold">return</span> <span style="background-color: #fff0f0">&quot;value&quot;</span><span style="color: #333333">;</span>
        <span style="color: #333333">});</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Cache</span> <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">final</span> String type<span style="color: #333333">;</span>
        <span style="color: #333399; font-weight: bold">boolean</span> stale<span style="color: #333333">;</span>
        String cached<span style="color: #333333">;</span>

        <span style="color: #008800; font-weight: bold">private</span> <span style="color: #0066BB; font-weight: bold">Cache</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">final</span> String type<span style="color: #333333">)</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">this</span><span style="color: #333333">.</span><span style="color: #0000CC">type</span> <span style="color: #333333">=</span> type<span style="color: #333333">;</span>
        <span style="color: #333333">}</span>

        Observable<span style="color: #333333">&lt;</span>String<span style="color: #333333">&gt;</span> <span style="color: #0066BB; font-weight: bold">getFromCache</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">final</span> <span style="color: #333399; font-weight: bold">boolean</span> ignoreStaleData<span style="color: #333333">)</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">return</span> Observable<span style="color: #333333">.</span><span style="color: #0000CC">defer</span><span style="color: #333333">(()</span> <span style="color: #333333">-&gt;</span> <span style="color: #333333">{</span>
                System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">.</span><span style="color: #0000CC">println</span><span style="color: #333333">(</span>String<span style="color: #333333">.</span><span style="color: #0000CC">format</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;getFrom [%s]&quot;</span><span style="color: #333333">,</span> type<span style="color: #333333">));</span>
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>cached <span style="color: #333333">==</span> <span style="color: #008800; font-weight: bold">null</span> <span style="color: #333333">||</span> <span style="color: #333333">(</span>stale <span style="color: #333333">&amp;&amp;</span> <span style="color: #333333">!</span>ignoreStaleData<span style="color: #333333">))</span> <span style="color: #333333">{</span>
                    <span style="color: #008800; font-weight: bold">return</span> Observable<span style="color: #333333">.</span><span style="color: #0000CC">empty</span><span style="color: #333333">();</span>
                <span style="color: #333333">}</span>

                <span style="color: #008800; font-weight: bold">return</span> Observable<span style="color: #333333">.</span><span style="color: #0000CC">just</span><span style="color: #333333">(</span>cached<span style="color: #333333">);</span>
            <span style="color: #333333">});</span>
        <span style="color: #333333">}</span>

        <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">putInCache</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">final</span> String value<span style="color: #333333">)</span> <span style="color: #333333">{</span>
            cached <span style="color: #333333">=</span> value<span style="color: #333333">;</span>
        <span style="color: #333333">}</span>

        <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">invalidate</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
            cached <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">;</span>
        <span style="color: #333333">}</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">DataSubscriber</span> <span style="color: #008800; font-weight: bold">extends</span> Subscriber<span style="color: #333333">&lt;</span>String<span style="color: #333333">&gt;</span> <span style="color: #333333">{</span>
        <span style="color: #555555; font-weight: bold">@Override</span>
        <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onCompleted</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>

        <span style="color: #333333">}</span>

        <span style="color: #555555; font-weight: bold">@Override</span>
        <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onError</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">final</span> Throwable e<span style="color: #333333">)</span> <span style="color: #333333">{</span>
            System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">.</span><span style="color: #0000CC">println</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Cannot load data&quot;</span><span style="color: #333333">);</span>
        <span style="color: #333333">}</span>

        <span style="color: #555555; font-weight: bold">@Override</span>
        <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onNext</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">final</span> String s<span style="color: #333333">)</span> <span style="color: #333333">{</span>
            System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">.</span><span style="color: #0000CC">println</span><span style="color: #333333">(</span>s<span style="color: #333333">);</span>
        <span style="color: #333333">}</span>
    <span style="color: #333333">}</span>
<span style="color: #333333">}</span>
</pre></div>
            </p>
            <h1 id="par-3">Various</h1>
            <h2 id="sub-par-3-1">Scheduling network requests</h2>
            <p>
                <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">SchedulingExceptionDemo</span> <span style="color: #333333">{</span>
    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">main</span><span style="color: #333333">(</span>String<span style="color: #333333">[]</span> args<span style="color: #333333">)</span> <span style="color: #008800; font-weight: bold">throws</span> IOException <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">final</span> MockWebServer mockWebServer <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> MockWebServer<span style="color: #333333">();</span>
        <span style="color: #008800; font-weight: bold">for</span> <span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> i <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">;</span> i <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">10</span><span style="color: #333333">;</span> i<span style="color: #333333">++)</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>i <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">2</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
                mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">enqueue</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> MockResponse<span style="color: #333333">().</span><span style="color: #0000CC">setBody</span><span style="color: #333333">(</span>DepartureTimes<span style="color: #333333">.</span><span style="color: #0000CC">getBody</span><span style="color: #333333">(</span>i<span style="color: #333333">)).</span><span style="color: #0000CC">setResponseCode</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">500</span><span style="color: #333333">));</span>
            <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
                mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">enqueue</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> MockResponse<span style="color: #333333">().</span><span style="color: #0000CC">setBody</span><span style="color: #333333">(</span>DepartureTimes<span style="color: #333333">.</span><span style="color: #0000CC">getBody</span><span style="color: #333333">(</span>i<span style="color: #333333">)).</span><span style="color: #0000CC">setResponseCode</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">200</span><span style="color: #333333">));</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">}</span>
        mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">start</span><span style="color: #333333">();</span>

        <span style="color: #008800; font-weight: bold">final</span> DepartureTimesApi departureTimesApi <span style="color: #333333">=</span> RetroFitFactory<span style="color: #333333">.</span><span style="color: #0000CC">getApi</span><span style="color: #333333">(</span>mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">url</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;/&quot;</span><span style="color: #333333">).</span><span style="color: #0000CC">toString</span><span style="color: #333333">(),</span> Schedulers<span style="color: #333333">.</span><span style="color: #0000CC">immediate</span><span style="color: #333333">()).</span><span style="color: #0000CC">create</span><span style="color: #333333">(</span>DepartureTimesApi<span style="color: #333333">.</span><span style="color: #0000CC">class</span><span style="color: #333333">);</span>

        <span style="color: #008800; font-weight: bold">final</span> TestScheduler testScheduler <span style="color: #333333">=</span> Schedulers<span style="color: #333333">.</span><span style="color: #0000CC">test</span><span style="color: #333333">();</span>
        Observable<span style="color: #333333">.</span><span style="color: #0000CC">interval</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">,</span> TimeUnit<span style="color: #333333">.</span><span style="color: #0000CC">SECONDS</span><span style="color: #333333">,</span> testScheduler<span style="color: #333333">)</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">doOnNext</span><span style="color: #333333">(</span>i <span style="color: #333333">-&gt;</span> System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">.</span><span style="color: #0000CC">println</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;INTERVAL = &quot;</span> <span style="color: #333333">+</span> i<span style="color: #333333">))</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">switchMap</span><span style="color: #333333">(</span>i <span style="color: #333333">-&gt;</span> departureTimesApi<span style="color: #333333">.</span><span style="color: #0000CC">getDepartureTimes</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;ut&quot;</span><span style="color: #333333">)</span> <span style="color: #888888">// switchMap only processes the latest event from the source (flatMap processes everything)</span>
                        <span style="color: #333333">.</span><span style="color: #0000CC">doOnError</span><span style="color: #333333">(</span>throwable <span style="color: #333333">-&gt;</span> System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">.</span><span style="color: #0000CC">println</span><span style="color: #333333">(</span>throwable<span style="color: #333333">.</span><span style="color: #0000CC">getMessage</span><span style="color: #333333">()))</span> <span style="color: #888888">// Log error</span>
                        <span style="color: #333333">.</span><span style="color: #0000CC">onErrorResumeNext</span><span style="color: #333333">(</span>Observable<span style="color: #333333">.</span><span style="color: #0000CC">empty</span><span style="color: #333333">()))</span> <span style="color: #888888">// Return empty observable</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">subscribe</span><span style="color: #333333">(</span>System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">::</span>println<span style="color: #333333">);</span>

        testScheduler<span style="color: #333333">.</span><span style="color: #0000CC">advanceTimeBy</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">,</span> TimeUnit<span style="color: #333333">.</span><span style="color: #0000CC">SECONDS</span><span style="color: #333333">);</span>
        testScheduler<span style="color: #333333">.</span><span style="color: #0000CC">advanceTimeBy</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">,</span> TimeUnit<span style="color: #333333">.</span><span style="color: #0000CC">SECONDS</span><span style="color: #333333">);</span>
        testScheduler<span style="color: #333333">.</span><span style="color: #0000CC">advanceTimeBy</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">,</span> TimeUnit<span style="color: #333333">.</span><span style="color: #0000CC">SECONDS</span><span style="color: #333333">);</span>
        testScheduler<span style="color: #333333">.</span><span style="color: #0000CC">advanceTimeBy</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">,</span> TimeUnit<span style="color: #333333">.</span><span style="color: #0000CC">SECONDS</span><span style="color: #333333">);</span>

        mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">shutdown</span><span style="color: #333333">();</span>
    <span style="color: #333333">}</span>
<span style="color: #333333">}</span>
</pre></div>

            </p>

            <h2 id="sub-par-3-2">Sharing values</h2>
            <p>
                <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">SharingValues</span> <span style="color: #333333">{</span>
    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">main</span><span style="color: #333333">(</span>String<span style="color: #333333">[]</span> args<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">final</span> Observable<span style="color: #333333">&lt;</span>Long<span style="color: #333333">&gt;</span> obs <span style="color: #333333">=</span> Observable<span style="color: #333333">.</span><span style="color: #0000CC">fromCallable</span><span style="color: #333333">(</span><span style="color: #997700; font-weight: bold">System:</span><span style="color: #333333">:</span>nanoTime<span style="color: #333333">).</span><span style="color: #0000CC">share</span><span style="color: #333333">().</span><span style="color: #0000CC">replay</span><span style="color: #333333">().</span><span style="color: #0000CC">autoConnect</span><span style="color: #333333">();</span>

        obs<span style="color: #333333">.</span><span style="color: #0000CC">subscribe</span><span style="color: #333333">(</span>System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">::</span>println<span style="color: #333333">);</span>
        obs<span style="color: #333333">.</span><span style="color: #0000CC">subscribe</span><span style="color: #333333">(</span>System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">::</span>println<span style="color: #333333">);</span>
        obs<span style="color: #333333">.</span><span style="color: #0000CC">subscribe</span><span style="color: #333333">(</span>System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">::</span>println<span style="color: #333333">);</span>
    <span style="color: #333333">}</span>
<span style="color: #333333">}</span>
</pre></div>

            </p>

            <h1 id="par-4">Functional</h1>
            <h2 id="sub-par-4-1">Auto suggest</h2>
            <p>
                <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">AutoSuggest</span> <span style="color: #333333">{</span>
    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">[]</span> SLEEP_TIMES <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> <span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">[]{</span><span style="color: #0000DD; font-weight: bold">30</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">30</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">30</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">30</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">10</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">10</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">10</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">30</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">30</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">10</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">10</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">30</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">30</span><span style="color: #333333">};</span>

    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">main</span><span style="color: #333333">(</span>String<span style="color: #333333">[]</span> args<span style="color: #333333">)</span> <span style="color: #008800; font-weight: bold">throws</span> InterruptedException <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">final</span> AutoSuggestService autoSuggestService <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> AutoSuggestService<span style="color: #333333">();</span>
        <span style="color: #008800; font-weight: bold">final</span> PublishSubject<span style="color: #333333">&lt;</span>String<span style="color: #333333">&gt;</span> searchField <span style="color: #333333">=</span> PublishSubject<span style="color: #333333">.</span><span style="color: #0000CC">create</span><span style="color: #333333">();</span>

        searchField
                <span style="color: #333333">.</span><span style="color: #0000CC">filter</span><span style="color: #333333">(</span>input <span style="color: #333333">-&gt;</span> input<span style="color: #333333">.</span><span style="color: #0000CC">length</span><span style="color: #333333">()</span> <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">2</span><span style="color: #333333">)</span> <span style="color: #888888">// Only search when input contains 3 characters or more</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">debounce</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">25</span><span style="color: #333333">,</span> TimeUnit<span style="color: #333333">.</span><span style="color: #0000CC">MILLISECONDS</span><span style="color: #333333">)</span> <span style="color: #888888">// Do not search immediately when typing fast</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">switchMap</span><span style="color: #333333">(</span>input <span style="color: #333333">-&gt;</span> autoSuggestService<span style="color: #333333">.</span><span style="color: #0000CC">suggest</span><span style="color: #333333">(</span>input<span style="color: #333333">)</span> <span style="color: #888888">// switchMap makes sure old requests are discard</span>
                        <span style="color: #333333">.</span><span style="color: #0000CC">doOnError</span><span style="color: #333333">(</span>System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">::</span>println<span style="color: #333333">)</span>
                        <span style="color: #333333">.</span><span style="color: #0000CC">onErrorResumeNext</span><span style="color: #333333">(</span>throwable <span style="color: #333333">-&gt;</span> Observable<span style="color: #333333">.</span><span style="color: #0000CC">just</span><span style="color: #333333">(</span>Collections<span style="color: #333333">.</span><span style="color: #0000CC">emptyList</span><span style="color: #333333">())))</span> <span style="color: #888888">// Do not die on onError</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">subscribe</span><span style="color: #333333">(</span>System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">::</span>println<span style="color: #333333">);</span>

        <span style="color: #008800; font-weight: bold">final</span> String input <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kor&quot;</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">for</span> <span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> i <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">;</span> i <span style="color: #333333">&lt;</span> input<span style="color: #333333">.</span><span style="color: #0000CC">length</span><span style="color: #333333">();</span> i<span style="color: #333333">++)</span> <span style="color: #333333">{</span>
            searchField<span style="color: #333333">.</span><span style="color: #0000CC">onNext</span><span style="color: #333333">(</span>input<span style="color: #333333">.</span><span style="color: #0000CC">substring</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">,</span> i<span style="color: #333333">));</span>
            Thread<span style="color: #333333">.</span><span style="color: #0000CC">sleep</span><span style="color: #333333">(</span>SLEEP_TIMES<span style="color: #333333">[</span>i<span style="color: #333333">]);</span>
        <span style="color: #333333">}</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">AutoSuggestService</span> <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">final</span> Map<span style="color: #333333">&lt;</span>String<span style="color: #333333">,</span> List<span style="color: #333333">&lt;</span>String<span style="color: #333333">&gt;&gt;</span> results <span style="color: #333333">=</span> initSearchResults<span style="color: #333333">();</span>

        <span style="color: #008800; font-weight: bold">private</span> Map<span style="color: #333333">&lt;</span>String<span style="color: #333333">,</span> List<span style="color: #333333">&lt;</span>String<span style="color: #333333">&gt;&gt;</span> initSearchResults<span style="color: #333333">()</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">final</span> Map<span style="color: #333333">&lt;</span>String<span style="color: #333333">,</span> List<span style="color: #333333">&lt;</span>String<span style="color: #333333">&gt;&gt;</span> values <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> HashMap<span style="color: #333333">&lt;&gt;();</span>
            values<span style="color: #333333">.</span><span style="color: #0000CC">put</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;&quot;</span><span style="color: #333333">,</span> Arrays<span style="color: #333333">.</span><span style="color: #0000CC">asList</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam Kerkstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Alkmaar Kerkstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amstelveen Kruisstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Abcoude Kerkstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Almere Kerkplein&quot;</span><span style="color: #333333">));</span>
            values<span style="color: #333333">.</span><span style="color: #0000CC">put</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;A&quot;</span><span style="color: #333333">,</span> Arrays<span style="color: #333333">.</span><span style="color: #0000CC">asList</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam Kerkstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Alkmaar Kerkstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amstelveen Kruisstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Abcoude Kerkstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Almere Kerkplein&quot;</span><span style="color: #333333">));</span>
            values<span style="color: #333333">.</span><span style="color: #0000CC">put</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Am&quot;</span><span style="color: #333333">,</span> Arrays<span style="color: #333333">.</span><span style="color: #0000CC">asList</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam Kerkstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kalverstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amstelveen Kruisstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amstelveen Kromweg&quot;</span><span style="color: #333333">));</span>
            values<span style="color: #333333">.</span><span style="color: #0000CC">put</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Ams&quot;</span><span style="color: #333333">,</span> Arrays<span style="color: #333333">.</span><span style="color: #0000CC">asList</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam Kerkstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kalverstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amstelveen Kruisstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amstelveen KraalWeg&quot;</span><span style="color: #333333">));</span>
            values<span style="color: #333333">.</span><span style="color: #0000CC">put</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amst&quot;</span><span style="color: #333333">,</span> Arrays<span style="color: #333333">.</span><span style="color: #0000CC">asList</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam Kerkstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kalverstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amstelveen Kruisstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amstelveen KromWeg&quot;</span><span style="color: #333333">));</span>
            values<span style="color: #333333">.</span><span style="color: #0000CC">put</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amste&quot;</span><span style="color: #333333">,</span> Arrays<span style="color: #333333">.</span><span style="color: #0000CC">asList</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam Kerkstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kalverstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amstelveen Kruisstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amstelveen Kromweg&quot;</span><span style="color: #333333">));</span>
            values<span style="color: #333333">.</span><span style="color: #0000CC">put</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amster&quot;</span><span style="color: #333333">,</span> Arrays<span style="color: #333333">.</span><span style="color: #0000CC">asList</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam Kerkstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kalverstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kometensingel&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Elpermeer&quot;</span><span style="color: #333333">));</span>
            values<span style="color: #333333">.</span><span style="color: #0000CC">put</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterd&quot;</span><span style="color: #333333">,</span> Arrays<span style="color: #333333">.</span><span style="color: #0000CC">asList</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam Kerkstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kalverstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kometensingel&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Elpermeer&quot;</span><span style="color: #333333">));</span>
            values<span style="color: #333333">.</span><span style="color: #0000CC">put</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterda&quot;</span><span style="color: #333333">,</span> Arrays<span style="color: #333333">.</span><span style="color: #0000CC">asList</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam Kerkstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kalverstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kometensingel&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Elpermeer&quot;</span><span style="color: #333333">));</span>
            values<span style="color: #333333">.</span><span style="color: #0000CC">put</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam&quot;</span><span style="color: #333333">,</span> Arrays<span style="color: #333333">.</span><span style="color: #0000CC">asList</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam Kerkstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kalverstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kometensingel&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Elpermeer&quot;</span><span style="color: #333333">));</span>
            values<span style="color: #333333">.</span><span style="color: #0000CC">put</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam &quot;</span><span style="color: #333333">,</span> Arrays<span style="color: #333333">.</span><span style="color: #0000CC">asList</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam Kerkstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kalverstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kometensingel&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Elpermeer&quot;</span><span style="color: #333333">));</span>
            values<span style="color: #333333">.</span><span style="color: #0000CC">put</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam K&quot;</span><span style="color: #333333">,</span> Arrays<span style="color: #333333">.</span><span style="color: #0000CC">asList</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam Kerkstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kalverstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kometensingel&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Korenbloemstraat&quot;</span><span style="color: #333333">));</span>
            values<span style="color: #333333">.</span><span style="color: #0000CC">put</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam Ko&quot;</span><span style="color: #333333">,</span> Arrays<span style="color: #333333">.</span><span style="color: #0000CC">asList</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam Korenbloemstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kompasstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Kometensingel&quot;</span><span style="color: #333333">));</span>
            values<span style="color: #333333">.</span><span style="color: #0000CC">put</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam Kor&quot;</span><span style="color: #333333">,</span> Arrays<span style="color: #333333">.</span><span style="color: #0000CC">asList</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Amsterdam Korenbloemstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Korte Leidsedwarsstraat&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Amsterdam Korte Keizersstraat&quot;</span><span style="color: #333333">));</span>
            <span style="color: #008800; font-weight: bold">return</span> values<span style="color: #333333">;</span>
        <span style="color: #333333">}</span>


        <span style="color: #008800; font-weight: bold">public</span> Observable<span style="color: #333333">&lt;</span>List<span style="color: #333333">&lt;</span>String<span style="color: #333333">&gt;&gt;</span> <span style="color: #0066BB; font-weight: bold">suggest</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">final</span> String input<span style="color: #333333">)</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">return</span> Observable<span style="color: #333333">.</span><span style="color: #0000CC">fromCallable</span><span style="color: #333333">(()</span> <span style="color: #333333">-&gt;</span> <span style="color: #333333">{</span>
                System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">.</span><span style="color: #0000CC">println</span><span style="color: #333333">(</span>String<span style="color: #333333">.</span><span style="color: #0000CC">format</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Search --&gt; %s&quot;</span><span style="color: #333333">,</span> input<span style="color: #333333">));</span>
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>input<span style="color: #333333">.</span><span style="color: #0000CC">length</span><span style="color: #333333">()</span> <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">3</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
                    Thread<span style="color: #333333">.</span><span style="color: #0000CC">sleep</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">50</span><span style="color: #333333">);</span>
                <span style="color: #333333">}</span>
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>input<span style="color: #333333">.</span><span style="color: #0000CC">length</span><span style="color: #333333">()</span> <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">7</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
                    <span style="color: #008800; font-weight: bold">throw</span> <span style="color: #008800; font-weight: bold">new</span> <span style="color: #0066BB; font-weight: bold">RuntimeException</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Error&quot;</span><span style="color: #333333">);</span>
                <span style="color: #333333">}</span>
                <span style="color: #008800; font-weight: bold">return</span> results<span style="color: #333333">.</span><span style="color: #0000CC">get</span><span style="color: #333333">(</span>input<span style="color: #333333">);</span>
            <span style="color: #333333">}).</span><span style="color: #0000CC">subscribeOn</span><span style="color: #333333">(</span>Schedulers<span style="color: #333333">.</span><span style="color: #0000CC">io</span><span style="color: #333333">());</span>
        <span style="color: #333333">}</span>
    <span style="color: #333333">}</span>
<span style="color: #333333">}</span>
</pre></div>

            </p>
            <h2 id="sub-par-4-2">Exponential Backoff</h2>
            <p>
                <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">ExponentialBackOff</span> <span style="color: #333333">{</span>
    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #008800; font-weight: bold">final</span> String RESPONSE <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;[\n&quot;</span> <span style="color: #333333">+</span>
            <span style="background-color: #fff0f0">&quot;  {\&quot;name\&quot;: \&quot;&#39;s-Hertogenbosch\&quot;},\n&quot;</span> <span style="color: #333333">+</span>
            <span style="background-color: #fff0f0">&quot;  {\&quot;name\&quot;: \&quot;Oss\&quot;},\n&quot;</span> <span style="color: #333333">+</span>
            <span style="background-color: #fff0f0">&quot;  {\&quot;name\&quot;: \&quot;Maastricht\&quot;},\n&quot;</span> <span style="color: #333333">+</span>
            <span style="background-color: #fff0f0">&quot;  {\&quot;name\&quot;: \&quot;Utrecht Centraal\&quot;},\n&quot;</span> <span style="color: #333333">+</span>
            <span style="background-color: #fff0f0">&quot;  {\&quot;name\&quot;: \&quot;Groningen\&quot;}\n&quot;</span> <span style="color: #333333">+</span>
            <span style="background-color: #fff0f0">&quot;]&quot;</span><span style="color: #333333">;</span>
    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">static</span> StationsApi stationsApi<span style="color: #333333">;</span>

    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">main</span><span style="color: #333333">(</span>String<span style="color: #333333">[]</span> args<span style="color: #333333">)</span> <span style="color: #008800; font-weight: bold">throws</span> IOException<span style="color: #333333">,</span> InterruptedException <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">final</span> TestScheduler testScheduler <span style="color: #333333">=</span> Schedulers<span style="color: #333333">.</span><span style="color: #0000CC">test</span><span style="color: #333333">();</span>
<span style="color: #888888">//        final Scheduler testScheduler = Schedulers.immediate();</span>
        <span style="color: #008800; font-weight: bold">final</span> <span style="color: #333399; font-weight: bold">int</span> maxFails <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">3</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">final</span> <span style="color: #333399; font-weight: bold">int</span> iterations <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">5</span> <span style="color: #333333">+</span> maxFails<span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">final</span> MockWebServer mockWebServer <span style="color: #333333">=</span> prepareResponses<span style="color: #333333">(</span>iterations<span style="color: #333333">,</span> maxFails<span style="color: #333333">);</span>
        stationsApi <span style="color: #333333">=</span> RetroFitFactory<span style="color: #333333">.</span><span style="color: #0000CC">getApi</span><span style="color: #333333">(</span>mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">url</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;/&quot;</span><span style="color: #333333">).</span><span style="color: #0000CC">toString</span><span style="color: #333333">(),</span> testScheduler<span style="color: #333333">).</span><span style="color: #0000CC">create</span><span style="color: #333333">(</span>StationsApi<span style="color: #333333">.</span><span style="color: #0000CC">class</span><span style="color: #333333">);</span>

        <span style="color: #888888">// Demo</span>
        <span style="color: #008800; font-weight: bold">final</span> Subscription subsription <span style="color: #333333">=</span> Observable<span style="color: #333333">.</span><span style="color: #0000CC">interval</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">,</span> TimeUnit<span style="color: #333333">.</span><span style="color: #0000CC">HOURS</span><span style="color: #333333">,</span> testScheduler<span style="color: #333333">)</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">doOnNext</span><span style="color: #333333">(</span>hour <span style="color: #333333">-&gt;</span> System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">.</span><span style="color: #0000CC">println</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;------------ &quot;</span> <span style="color: #333333">+</span> hour <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; hour(s) ------------&quot;</span><span style="color: #333333">))</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">switchMap</span><span style="color: #333333">(</span>i <span style="color: #333333">-&gt;</span> updateStations<span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">4</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">,</span> testScheduler<span style="color: #333333">)</span>
                        <span style="color: #333333">.</span><span style="color: #0000CC">doOnError</span><span style="color: #333333">(</span>throwable <span style="color: #333333">-&gt;</span> System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">.</span><span style="color: #0000CC">println</span><span style="color: #333333">(</span>throwable<span style="color: #333333">.</span><span style="color: #0000CC">getMessage</span><span style="color: #333333">()))</span>
                        <span style="color: #333333">.</span><span style="color: #0000CC">onErrorResumeNext</span><span style="color: #333333">(</span>throwable <span style="color: #333333">-&gt;</span> Observable<span style="color: #333333">.</span><span style="color: #0000CC">empty</span><span style="color: #333333">()))</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">subscribe</span><span style="color: #333333">(</span>System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">::</span>println<span style="color: #333333">);</span>

        <span style="color: #008800; font-weight: bold">for</span> <span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> i <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">;</span> i <span style="color: #333333">&lt;</span> iterations<span style="color: #333333">;</span> i<span style="color: #333333">++)</span> <span style="color: #333333">{</span>
            testScheduler<span style="color: #333333">.</span><span style="color: #0000CC">advanceTimeBy</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">,</span> TimeUnit<span style="color: #333333">.</span><span style="color: #0000CC">HOURS</span><span style="color: #333333">);</span>
        <span style="color: #333333">}</span>
        <span style="color: #888888">// Demo</span>

        subsription<span style="color: #333333">.</span><span style="color: #0000CC">unsubscribe</span><span style="color: #333333">();</span>
        mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">shutdown</span><span style="color: #333333">();</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">static</span> MockWebServer <span style="color: #0066BB; font-weight: bold">prepareResponses</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">final</span> <span style="color: #333399; font-weight: bold">int</span> iterations<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #333399; font-weight: bold">int</span> maxFailes<span style="color: #333333">)</span> <span style="color: #008800; font-weight: bold">throws</span> IOException <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">final</span> MockWebServer mockWebServer <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> MockWebServer<span style="color: #333333">();</span>
        <span style="color: #008800; font-weight: bold">for</span> <span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> i <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">;</span> i <span style="color: #333333">&lt;</span> iterations <span style="color: #333333">+</span> maxFailes<span style="color: #333333">;</span> i<span style="color: #333333">++)</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>i <span style="color: #333333">&gt;=</span> <span style="color: #0000DD; font-weight: bold">2</span> <span style="color: #333333">&amp;&amp;</span> i <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">2</span> <span style="color: #333333">+</span> maxFailes<span style="color: #333333">)</span> <span style="color: #333333">{</span>
                mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">enqueue</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> MockResponse<span style="color: #333333">().</span><span style="color: #0000CC">setResponseCode</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">500</span><span style="color: #333333">));</span>
            <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
                mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">enqueue</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> MockResponse<span style="color: #333333">().</span><span style="color: #0000CC">setBody</span><span style="color: #333333">(</span>RESPONSE<span style="color: #333333">).</span><span style="color: #0000CC">setResponseCode</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">200</span><span style="color: #333333">));</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">}</span>
        mockWebServer<span style="color: #333333">.</span><span style="color: #0000CC">start</span><span style="color: #333333">();</span>
        <span style="color: #008800; font-weight: bold">return</span> mockWebServer<span style="color: #333333">;</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">static</span> Observable<span style="color: #333333">&lt;</span>List<span style="color: #333333">&lt;</span>Station<span style="color: #333333">&gt;&gt;</span> <span style="color: #0066BB; font-weight: bold">updateStations</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">final</span> <span style="color: #333399; font-weight: bold">int</span> maxRetries<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #333399; font-weight: bold">int</span> numRetries<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">final</span> Scheduler scheduler<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">.</span><span style="color: #0000CC">println</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Retrieve stations&quot;</span><span style="color: #333333">);</span>
        <span style="color: #008800; font-weight: bold">final</span> <span style="color: #333399; font-weight: bold">long</span> delay <span style="color: #333333">=</span> <span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">long</span><span style="color: #333333">)</span> Math<span style="color: #333333">.</span><span style="color: #0000CC">pow</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">2</span><span style="color: #333333">,</span> numRetries<span style="color: #333333">)</span> <span style="color: #333333">*</span> <span style="color: #0000DD; font-weight: bold">1000</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">return</span> stationsApi<span style="color: #333333">.</span><span style="color: #0000CC">retrieveStations</span><span style="color: #333333">()</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">doOnError</span><span style="color: #333333">(</span>throwable <span style="color: #333333">-&gt;</span> <span style="color: #333333">{</span>
                    System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">.</span><span style="color: #0000CC">println</span><span style="color: #333333">(</span>String<span style="color: #333333">.</span><span style="color: #0000CC">format</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Error. Retrying again in %d milliseconds&quot;</span><span style="color: #333333">,</span> delay<span style="color: #333333">));</span>
                <span style="color: #333333">})</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">onErrorResumeNext</span><span style="color: #333333">(</span>throwable <span style="color: #333333">-&gt;</span> <span style="color: #333333">{</span>
                    <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>numRetries <span style="color: #333333">&lt;</span> maxRetries<span style="color: #333333">)</span> <span style="color: #333333">{</span>
                        System<span style="color: #333333">.</span><span style="color: #0000CC">out</span><span style="color: #333333">.</span><span style="color: #0000CC">println</span><span style="color: #333333">(</span>String<span style="color: #333333">.</span><span style="color: #0000CC">format</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Retrying %d time&quot;</span><span style="color: #333333">,</span> numRetries<span style="color: #333333">));</span>
                        <span style="color: #008800; font-weight: bold">return</span> Observable<span style="color: #333333">.</span><span style="color: #0000CC">just</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">).</span><span style="color: #0000CC">delay</span><span style="color: #333333">(</span>delay<span style="color: #333333">,</span> TimeUnit<span style="color: #333333">.</span><span style="color: #0000CC">MILLISECONDS</span><span style="color: #333333">,</span> scheduler<span style="color: #333333">)</span>
                                <span style="color: #333333">.</span><span style="color: #0000CC">switchMap</span><span style="color: #333333">(</span>i <span style="color: #333333">-&gt;</span> updateStations<span style="color: #333333">(</span>maxRetries<span style="color: #333333">,</span> numRetries <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">,</span> scheduler<span style="color: #333333">));</span>
                    <span style="color: #333333">}</span>

                    <span style="color: #008800; font-weight: bold">return</span> Observable<span style="color: #333333">.</span><span style="color: #0000CC">error</span><span style="color: #333333">(</span>throwable<span style="color: #333333">);</span>
                <span style="color: #333333">});</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">interface</span> <span style="color: #BB0066; font-weight: bold">StationsApi</span> <span style="color: #333333">{</span>

        <span style="color: #555555; font-weight: bold">@GET</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;/stations&quot;</span><span style="color: #333333">)</span>
        Observable<span style="color: #333333">&lt;</span>List<span style="color: #333333">&lt;</span>Station<span style="color: #333333">&gt;&gt;</span> <span style="color: #0066BB; font-weight: bold">retrieveStations</span><span style="color: #333333">();</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Station</span> <span style="color: #333333">{</span>
        String name<span style="color: #333333">;</span>

        <span style="color: #555555; font-weight: bold">@Override</span>
        <span style="color: #008800; font-weight: bold">public</span> String <span style="color: #0066BB; font-weight: bold">toString</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">final</span> StringBuilder sb <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> StringBuilder<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Station{&quot;</span><span style="color: #333333">);</span>
            sb<span style="color: #333333">.</span><span style="color: #0000CC">append</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;name=&#39;&quot;</span><span style="color: #333333">).</span><span style="color: #0000CC">append</span><span style="color: #333333">(</span>name<span style="color: #333333">).</span><span style="color: #0000CC">append</span><span style="color: #333333">(</span><span style="color: #0044DD">&#39;\&#39;&#39;</span><span style="color: #333333">);</span>
            sb<span style="color: #333333">.</span><span style="color: #0000CC">append</span><span style="color: #333333">(</span><span style="color: #0044DD">&#39;}&#39;</span><span style="color: #333333">);</span>
            <span style="color: #008800; font-weight: bold">return</span> sb<span style="color: #333333">.</span><span style="color: #0000CC">toString</span><span style="color: #333333">();</span>
        <span style="color: #333333">}</span>
    <span style="color: #333333">}</span>
<span style="color: #333333">}</span>
</pre></div>

            </p>
        </div>
    </div>
</div>

<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function () {
        var sidebarMainMenu = $('#sidebar-menu .main-menu');
        var staticContent = $('#static-content');
        staticContent.find('h1').each(function () {
            sidebarMainMenu.append('<li id="' + $(this).attr('id') + '-menu"><a href="#' + $(this).attr('id') + '">' + $(this).html() + '</li>');
            title = sidebarMainMenu.find('#' + $(this).attr('id'));
        });
        staticContent.find('h2').each(function () {
            prevTitle = sidebarMainMenu.find('#' + $(this).prevAll('h1').first().attr('id') + '-menu');
            prevTitle.not(":has(ul)").append('<ul class="sub-menu"></ul>');
            prevTitle.find('.sub-menu').append('<li id="' + $(this).attr('id') + '-menu"><a href="#' + $(this).attr('id') + '">' + $(this).html() + '</li>');
        });
        sidebarMainMenu.affix({
            offset: {
                top: 0  // To Modify according to the height offset
            }
        });
    });
</script>
</body>
</html>